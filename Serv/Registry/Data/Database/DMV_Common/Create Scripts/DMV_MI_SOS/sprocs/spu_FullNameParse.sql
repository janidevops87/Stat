SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO

if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[spu_FullNameParse]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
Begin
	drop procedure [dbo].[spu_FullNameParse]
End
GO



CREATE PROCEDURE spu_FullNameParse AS

--- START FIX GOT COMMA
	/*
	select 
	--REPLACE(FULLNAME,'"', ''),
	LEN(FULLNAME),
	CHARINDEX(',', FULLNAME, 1) AS 'GOT COMMA' , 
	SUBSTRING(FULLNAME,CHARINDEX(',', FULLNAME, 1)+1,LEN(FULLNAME)),
	SUBSTRING(FULLNAME,1,CHARINDEX(',', FULLNAME, 1)-1),
	SUBSTRING(FULLNAME,CHARINDEX(',', FULLNAME, 1)+1,LEN(FULLNAME)) + ' ' +
	SUBSTRING(FULLNAME,1,CHARINDEX(',', FULLNAME, 1)-1),
	
	RTRIM(LTRIM(FULLNAME)) from IMPORT_A 
	where CHARINDEX(',', FULLNAME, 1) > 0
	*/
	----- REMOVE QUOTES
	UPDATE IMPORT_A
	SET FULLNAME = REPLACE(FULLNAME,'"', '')
	FROM IMPORT_A 
	WHERE CHARINDEX(',', FULLNAME, 1) > 0

	-- REARRANGE NAME
	UPDATE IMPORT_A
	SET FULLNAME =	SUBSTRING(FULLNAME,CHARINDEX(',', FULLNAME, 1)+1,LEN(FULLNAME)) + ' ' +
			SUBSTRING(FULLNAME,1,CHARINDEX(',', FULLNAME, 1)-1)
	FROM IMPORT_A 
	WHERE CHARINDEX(',', FULLNAME, 1) > 0

--- END FIX GOT COMMA

-- START CONVERT TO UPPERCASE

	UPDATE IMPORT_A
	SET FULLNAME = UPPER(FULLNAME)

-- END CONVERT TO UPPERCASE

--- START REMOVE COMMAS
	UPDATE IMPORT_A
	SET FULLNAME = REPLACE(FULLNAME, ',', '')
	from IMPORT_A 
	WHERE CHARINDEX(',',FULLNAME) > 0
--- END REMOVE COMMAS

--- START REMOVE PERIODS
	UPDATE IMPORT_A
	SET FULLNAME = REPLACE(FULLNAME, '.', '')
	from IMPORT_A 
	WHERE CHARINDEX('.',FULLNAME) > 0
--- END REMOVE PERIOD



--- START FIX TRAILING AND LEADING SPACES
	UPDATE IMPORT_A
	SET FULLNAME = 	RTRIM(LTRIM(FULLNAME))
--- END FIX TRAILING AND LEADING SPACES
--- START REPLACE EMPTY WITH NULL
	UPDATE IMPORT_A
	SET FULLNAME = NULL
	FROM IMPORT_A
	WHERE LEN(FULLNAME) = 0
--- END  REPLACE EMPTY WITH NULL

--- START UPDATE SUFFIX WHERE SUFFIX IS FIRST SET OF CHARACTERS

	UPDATE IMPORT_A
	SET SUFFIX = RTRIM(LTRIM(SUBSTRING(FULLNAME,1, CHARINDEX(' ', FULLNAME, 1) -1))),
	    FULLNAME = RTRIM(LTRIM(REPLACE(FULLNAME, RTRIM(LTRIM(SUBSTRING(FULLNAME,1, CHARINDEX(' ', FULLNAME, 1) -1))), '')))
	FROM IMPORT_A 
	WHERE FULLNAME LIKE '[I][ IV][I ]%' 
	OR fullname like '[V][ ]%' 
	OR fullname like '[V][I][ ]%' 
	OR fullname like '[SJ][R][ ]%'

-- END UPDATE SUFFIX WHERE SUFFIX IS FIRST SET OF CHARACTERS

-- START UPDATE SUFFIX WHERE SUFFIX IS LAST SET OF CHARACTERS

	UPDATE IMPORT_A
	SET SUFFIX = REVERSE(RTRIM(LTRIM(SUBSTRING(REVERSE(FULLNAME),1, CHARINDEX(' ', REVERSE(FULLNAME), 1) -1)))),
 	    FULLNAME = REVERSE(RTRIM(LTRIM(REPLACE(REVERSE(FULLNAME), RTRIM(LTRIM(SUBSTRING(REVERSE(FULLNAME),1, CHARINDEX(' ', REVERSE(FULLNAME), 1) -1))), ''))))

	FROM IMPORT_A 
	WHERE  REVERSE(FULLNAME) LIKE '[ I][VI ][ I][^a-z]%' --    [I][ IV][I ]%' 
	OR REVERSE(FULLNAME) like '[V][I ]%' --'[V][ ]%' 
	OR REVERSE(FULLNAME) like '[V][I][ ]%' --'[V][ ]%' 
	OR REVERSE(FULLNAME) like '[I ][V][ ]%' --'[V][I][ ]%' 
	OR REVERSE(FULLNAME) like '[R][SJ][ ]%' -- '[SJ][R][ ]%'
-- END  UPDATE SUFFIX WHERE SUFFIX IS LAST SET OF CHARACTERS

--- START ADD FIRST AND LAST NAME

	UPDATE IMPORT_A
	SET	FIRST = RTRIM(LTRIM(SUBSTRING(FULLNAME,1, CHARINDEX(' ', FULLNAME, 1) -1))),
		LAST  = RTRIM(LTRIM(SUBSTRING(FULLNAME, CHARINDEX(' ', FULLNAME, 1), LEN(FULLNAME))))
	from IMPORT_A 
	WHERE FULLNAME IS NOT NULL
	AND CHARINDEX(' ', FULLNAME, 1) > 0
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) = 0
	--AND ISNULL(FIRST, '') + ISNULL(LAST, '') + ISNULL(MIDDLE, '') = ''
	AND FIRST IS NULL 	AND LAST IS NULL	AND MIDDLE IS NULL
--- END ADD FIRST AND LAST NAME
--- START ADD FIRST , LAST AND MIDDLE NAME

	UPDATE IMPORT_A
	SET	FIRST  = RTRIM(LTRIM(SUBSTRING(FULLNAME,1, CHARINDEX(' ', FULLNAME, 1) -1))),
		MIDDLE = RTRIM(LTRIM(SUBSTRING(FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) - CHARINDEX(' ', FULLNAME, 1)))),
		LAST   = RTRIM(LTRIM(SUBSTRING(FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1), LEN(FULLNAME))))
	from IMPORT_A 
	WHERE FULLNAME IS NOT NULL
	AND CHARINDEX(' ', FULLNAME, 1) > 0
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) > 0 
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 ) = 0
	--AND ISNULL(FIRST, '') + ISNULL(LAST, '') + ISNULL(MIDDLE, '') = ''
	AND FIRST IS NULL 	AND LAST IS NULL	AND MIDDLE IS NULL

--- END ADD FIRST , LAST AND MIDDLE NAME
--- START REMOVE MULTIPLE SPACES BETWEEN NAMES
	UPDATE IMPORT_A
	SET FULLNAME = REPLACE(FULLNAME, '  ', ' ')
	WHERE FULLNAME IS NOT NULL
	--AND ISNULL(FIRST, '') + ISNULL(LAST, '') + ISNULL(MIDDLE, '') = ''
	AND FIRST IS NULL 	AND LAST IS NULL	AND MIDDLE IS NULL
	AND FULLNAME LIKE '%  %'
--- START REMOVE MULTIPLE SPACES BETWEEN NAMES
--- START FIRST, MIDDLE, LAST AND SUFFIX FOR JR
	UPDATE IMPORT_A
	SET	FIRST  = RTRIM(LTRIM(SUBSTRING(FULLNAME,1, CHARINDEX(' ', FULLNAME, 1) -1))),
		MIDDLE = RTRIM(LTRIM(SUBSTRING(FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) - CHARINDEX(' ', FULLNAME, 1)))),
		LAST   = RTRIM(LTRIM(	SUBSTRING(FULLNAME, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1)	, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 ) - CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1)	))),
		SUFFIX = 	RTRIM(LTRIM(	SUBSTRING(FULLNAME, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 )	, LEN(FULLNAME)	)))
	from IMPORT_A 
	WHERE FULLNAME IS NOT NULL
	AND CHARINDEX(' ', FULLNAME, 1) > 0
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) > 0 
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 ) > 0 
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 )+1 ) = 0
	--AND ISNULL(FIRST, '') + ISNULL(LAST, '') + ISNULL(MIDDLE, '') = ''
	AND FIRST IS NULL 	AND LAST IS NULL	AND MIDDLE IS NULL
	AND FULLNAME LIKE '%[SJ1][R1]'

--- END FIRST, MIDDLE, LAST AND SUFFIX FOR JR, SR, II

--- START FIRST, MIDDLE, LAST AND SUFFIX FOR I, II, II, V, IV
	UPDATE IMPORT_A
	SET	FIRST  = RTRIM(LTRIM(SUBSTRING(FULLNAME,1, CHARINDEX(' ', FULLNAME, 1) -1))),
		MIDDLE = RTRIM(LTRIM(SUBSTRING(FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) - CHARINDEX(' ', FULLNAME, 1)))),
		LAST   = RTRIM(LTRIM(	SUBSTRING(FULLNAME, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1)	, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 ) - CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1)	))),
		SUFFIX = 	RTRIM(LTRIM(	SUBSTRING(FULLNAME, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 )	, LEN(FULLNAME)	)))
	from IMPORT_A 
	WHERE FULLNAME IS NOT NULL
	AND CHARINDEX(' ', FULLNAME, 1) > 0
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) > 0 
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 ) > 0 
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 )+1 ) = 0
	--AND ISNULL(FIRST, '') + ISNULL(LAST, '') + ISNULL(MIDDLE, '') = ''
	AND FIRST IS NULL 	AND LAST IS NULL	AND MIDDLE IS NULL
	AND FULLNAME LIKE '%[I1V]'
--- END FIRST, MIDDLE, LAST AND SUFFIX FOR JR
--- START FIRST, MIDDLE, LAST AND SUFFIX FOR SIR
	UPDATE IMPORT_A
	SET	FIRST  = RTRIM(LTRIM(SUBSTRING(FULLNAME,1, CHARINDEX(' ', FULLNAME, 1) -1))),
		MIDDLE = RTRIM(LTRIM(SUBSTRING(FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) - CHARINDEX(' ', FULLNAME, 1)))),
		LAST   = RTRIM(LTRIM(	SUBSTRING(FULLNAME, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1)	, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 ) - CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1)	))),
		SUFFIX = 	RTRIM(LTRIM(	SUBSTRING(FULLNAME, 		CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 )	, LEN(FULLNAME)	)))
	from IMPORT_A 
	WHERE FULLNAME IS NOT NULL
	AND CHARINDEX(' ', FULLNAME, 1) > 0
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1) > 0 
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 ) > 0 
	AND CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, CHARINDEX(' ', FULLNAME, 1)+1 )+1 )+1 ) = 0
	--AND ISNULL(FIRST, '') + ISNULL(LAST, '') + ISNULL(MIDDLE, '') = ''
	AND FIRST IS NULL 	AND LAST IS NULL	AND MIDDLE IS NULL
	AND FULLNAME LIKE '%SIR'
--- END FIRST, MIDDLE, LAST AND SUFFIX FOR JR



GO
SET QUOTED_IDENTIFIER OFF 
GO
SET ANSI_NULLS ON 
GO

/******************************* BEGIN ERROR HANDLING *********************************************/
	IF @@ERROR <> 0 
	BEGIN
	   PRINT '*** ERROR - spu_FullNameParse create script failed'
	   PRINT ''
	END
	ELSE
	BEGIN
	   PRINT 'SUCCESS - 3.0 Procedure spu_FullNameParse Created'
	   PRINT ''
	END
	GO
/********************************* END ERROR HANDLING *********************************************/


